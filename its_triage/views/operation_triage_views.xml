<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- Operation Triage Tree view -->
  <record id="operation_triage_tree" model="ir.ui.view">
    <field name="name">operation.triage.tree</field>
    <field name="model">operation.triage</field>
    <field name="arch" type="xml">
      <tree string="Triages" decoration-muted="state in ('cancelled')" decoration-info="state in ('draft')"
            decoration-success="state in ('sorted')">
        <field name="name"/>
        <field name="output_date"/>
        <field name="product_ids" widget="many2many_tags"/>
        <field name="state"/>
      </tree>
    </field>
  </record>

  <record id="operation_manual_triage_tree" model="ir.ui.view">
    <field name="name">operation.triage.tree</field>
    <field name="model">operation.triage</field>
    <field name="arch" type="xml">
      <tree string="Triages" decoration-muted="state in ('cancelled')" decoration-info="state in ('draft')"
            decoration-success="state in ('sorted')">
        <field name="currency_id" invisible="1"/>
        <field name="name"/>
        <field name="product_id"/>
        <field name="employee_id"/>
        <field name="output_date"/>
        <field name="entry_date"/>
        <field name="wage" widget="monetary" sum="Total Wage"/>
        <field name="state"/>
      </tree>
    </field>
  </record>

  <!-- Operation Triage Calendar view -->
  <record id="operation_manual_triage_calendar" model="ir.ui.view">
    <field name="name">operation.triage.calendar</field>
    <field name="model">operation.triage</field>
    <field name="arch" type="xml">
      <calendar date_start="output_date" date_stop="entry_date" string="Event Organization" mode="month"
                color="employee_id" event_limit="5">
        <field name="currency_id" invisible="1"/>
        <field name="employee_id" avatar_field="image_128"/>
        <field name="product_id"/>
        <field name="wage" widget="monetary"/>
        <field name="state"/>
      </calendar>
    </field>
  </record>

  <!-- Operation Triage Form view -->
  <record id="operation_triage_form" model="ir.ui.view">
    <field name="name">operation.triage.form</field>
    <field name="model">operation.triage</field>
    <field name="arch" type="xml">
      <form string="Triages">
        <header>
          <button name="action_sort" string="Sort" type="object"
                  class="oe_highlight"
                  states="draft"/>
          <button name="action_cancel" string="Cancel" states="draft" type="object"
                  class="btn-secondary" confirm="Are you sure you want to cancel this operation?"/>
          <field name="state" widget="statusbar" statusbar_visible="draft,sorted"/>
        </header>
        <sheet>
          <widget name="web_ribbon" title="Sorted" bg_color="bg-success"
                  attrs="{'invisible': [('state', '!=', 'sorted')]}"/>
          <div class="oe_title">
            <h1>
              <field name="name" readonly="1" force_save="1"/>
            </h1>
          </div>
          <group>
            <field name="type" invisible="1"/>
            <field name="currency_id" invisible="1"/>
            <group>
              <field name="product_id"
                     attrs="{'readonly': [('state', 'not in', ['draft'])], 'invisible': [('type', 'in', ['auto', 'small'])], 'required': [('type', '=', 'manual')]}"
                     domain="[('type', '=', 'product')]"/>
              <label for="qty_available"/>
              <div class="text-info">
                <field name="qty_available" nolabel="1"/>
                <field name="uom_name" style="margin-left: 5px;"/>
              </div>
            </group>
            <group>
              <field name="employee_id"
                     attrs="{'required': [('type', '=', 'manual')], 'invisible': [('type', '!=', 'manual')]}"/>
              <field name="output_date"
                     attrs="{'required': [('type', '=', 'manual')]}"/>
              <field name="entry_date"
                     attrs="{'invisible': [('type', '!=', 'manual')]}"/>
              <label for="output_quantity" attrs="{'invisible': [('type', '!=', 'manual')]}"/>
              <div class="text-danger" attrs="{'invisible': [('type', '!=', 'manual')]}">
                <field name="output_quantity" nolabel="1" required="1"
                       attrs="{'readonly': [('state', 'not in', ['draft'])]}"/>
                <field name="uom_name" style="margin-left: 5px;" class="oe_read_only"/>
              </div>
            </group>
          </group>
          <notebook>
            <page name="products" string="Products"
                  attrs="{'invisible': [('type', '=', 'manual')]}">
              <field name="product_list_ids" widget="one2many"
                     attrs="{'readonly': [('state', 'not in', ['draft'])], 'invisible': [('type', '=', 'manual')]}">
                <tree string="Products" editable="bottom">
                  <field name="product_id"/>
                  <field name="qty_available" readonly="1" force_save="1"/>
                  <field name="output_quantity" sum="Total"/>
                </tree>
              </field>
            </page>
            <page name="variants" string="Variants">
              <field name="attribute_line_ids" widget="one2many" context="{'show_attribute': False}"
                     attrs="{'readonly': [('state', 'not in', ['draft'])]}">
                <tree string="Variants" editable="bottom">
                  <field name="attribute_id" attrs="{'readonly': [('id', '!=', False)]}"/>
                  <field name="value_ids" widget="many2many_tags" options="{'no_create_edit': True}"
                         context="{'default_attribute_id': attribute_id, 'show_attribute': False}"/>
                </tree>
              </field>
              <p class="oe_grey oe_edit_only">
                <strong>Warning</strong>: adding or deleting attributes
                will delete and recreate existing values and lead
                to the loss of their possible customizations.
              </p>
              <group class="oe_subtotal_footer" attrs="{'invisible': [('type', '!=', 'manual')]}">
                <field name="wage" class="oe_subtotal_footer_separator"/>
              </group>
            </page>
            <page name="values" string="Values">
              <field name="line_ids" widget="one2many" attrs="{'readonly': [('state', 'not in', ['draft'])]}">
                <tree string="Lines" create="0" delete="0" editable="bottom">
                  <field name="product_template_attribute_value_ids" widget="many2many_tags" readonly="1"/>
                  <field name="quantity" sum="Total"/>
                </tree>
              </field>
            </page>
          </notebook>
        </sheet>
        <div class="oe_chatter">
          <field name="message_follower_ids" widget="mail_followers"/>
          <field name="activity_ids" widget="mail_activity"/>
          <field name="message_ids" widget="mail_thread" options="{'post_refresh': 'recipients'}"/>
        </div>
      </form>
    </field>
  </record>

  <!-- Operation Triage Search view -->
  <record id="operation_triage_search" model="ir.ui.view">
    <field name="name">operation.triage.form</field>
    <field name="model">operation.triage</field>
    <field name="arch" type="xml">
      <search string="Operation Triages">
        <field name="name"/>
        <field name="product_ids" filter_domain="[('product_ids', 'ilike', self)]"/>
        <separator/>
        <filter string="Date" name="year" date="output_date" default_period="this_year"/>
        <group expand="0" string="Group By">
          <filter string="State" name="state" domain="[]" context="{'group_by': 'state'}"/>
          <separator orientation="vertical"/>
          <filter string="Date" context="{'group_by':'output_date:month'}" name="month"/>
        </group>
      </search>
    </field>
  </record>

  <record id="operation_manual_triage_search" model="ir.ui.view">
    <field name="name">operation.triage.form</field>
    <field name="model">operation.triage</field>
    <field name="arch" type="xml">
      <search string="Operation Triages">
        <field name="name"/>
        <field name="product_id"/>
        <field name="employee_id"/>
        <separator/>
        <filter string="Output Date" name="output_date" date="date"/>
        <filter string="Entry Date" name="entry_date" date="date"/>
        <group expand="0" string="Group By">
          <filter string="Product" name="product_id" domain="[]" context="{'group_by': 'product_id'}"/>
          <filter string="Employee" name="employee_id" domain="[]" context="{'group_by': 'employee_id'}"/>
          <filter string="State" name="state" domain="[]" context="{'group_by': 'state'}"/>
          <separator orientation="vertical"/>
          <filter string="Output Date" name="output_date" domain="[]" context="{'group_by': 'output_date'}"/>
          <filter string="Entry Date" name="entry_date" domain="[]" context="{'group_by': 'entry_date'}"/>
        </group>
      </search>
    </field>
  </record>

  <!-- Operation Triage Action menu -->
  <record id="operation_triage_menu_action" model="ir.actions.act_window">
    <field name="name">Automations</field>
    <field name="res_model">operation.triage</field>
    <field name="view_mode">tree,form</field>
    <field name="context">{"default_type": 'auto'}</field>
    <field name="search_view_id" ref="operation_triage_search"/>
    <field name="domain">[('type', '=', 'auto')]</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Create an new automatic triage
      </p>
    </field>
  </record>

  <record id="operation_manual_triage_menu_action" model="ir.actions.act_window">
    <field name="name">Manuals</field>
    <field name="res_model">operation.triage</field>
    <field name="view_mode">tree,form,calendar</field>
    <field name="context">{"default_type": 'manual'}</field>
    <field name="search_view_id" ref="operation_manual_triage_search"/>
    <field name="view_id" ref="operation_manual_triage_tree"/>
    <field name="domain">[('type', '=', 'manual')]</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Create a new manual triage
      </p>
    </field>
  </record>

  <record id="operation_small_triage_menu_action" model="ir.actions.act_window">
    <field name="name">Smalls</field>
    <field name="res_model">operation.triage</field>
    <field name="view_mode">tree,form,calendar</field>
    <field name="context">{"default_type": 'small'}</field>
    <field name="search_view_id" ref="operation_triage_search"/>
    <field name="view_id" ref="operation_triage_tree"/>
    <field name="domain">[('type', '=', 'small')]</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Create a new small triage
      </p>
    </field>
  </record>

</odoo>
